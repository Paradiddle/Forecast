<!DOCTYPE html>
	<head>
		<title>Budget Forecaster</title>
		
		<noscript>Your browser does not have Javascript enabled.</noscript>
		<link href="css/style.css" rel="stylesheet">
		<link href="css/jquery-ui.css" rel="stylesheet">
		<link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,700' rel='stylesheet' type='text/css'>
		<script src="js/jquery.js"></script>
		<script src="js/jquery-ui-1.9.0.js"></script>
		<script src="js/jquery-validate.js"></script>
		<script src="js/underscore.js"></script>
		<script src="js/backbone.js"></script>
		<script src="js/helper.js"></script> 
		<script src="js/mousewheel.js"></script>  
		<script src="js/scroll.js"></script>         
	</head>

	<body onunload="saveData();">	
		<div class="fullWidth Header">
			<img src="images/logo.jpg" style="float:left; border:0; margin-top:10px;"/>
			
			<div style="float: right;">
				{{ message_pretext }} <a href={{url}}>{{url_linktext}}</a>{{message_posttext}}
				<br />
				<!--<img style="float: right; padding-top: 10px;" src="images/appengine-silver-120x30.gif" />-->
			</div>
				
			<div style="clear:both"></div>
		</div>	
		
		{% if username %}
		
		
		<!-- Entry data input form -->
		
		<div id="add_dialog_div" style="display=none; position=absolute; z-index:5">
			<form onsubmit="return false;" id="add_dialog_form">
				<table class="fieldset" bgcolor="white">
					<tr>
						<td colspan="2">
							<label class="Heading blue" id="dialog_status">Add Monthly Entry</label>
						</td>
					</tr>
					<tr>
						<td width="50%">
							<label for="input_name">Entry Name</label>								
						</td>
						<td width="50%">
							<input style="width: 100%;" type="text" class="in required" id="input_name" name="input_name">
						</td>
					</tr>
					<tr>
						<td>
							<label for="input_amount">Entry Amount</label>
						</td>
						<td>
							<input style="width: 100%;" type="text" class="in required" id="input_amount" name="input_amount">
						</td>
					</tr>
					<tr>
						<td>
							<label for="entry_type">Type</label>
						</td>
						<td>
							<input type="radio" name="entry_type" title="Income"> Income<br>
							<input type="radio" name="entry_type" title="Expense" checked="checked"> Expense
						</td>
					</tr>
					<tr class="month_option">
						<td>
							<label for="checkbox_monthly">Monthly</label>
						</td>
						<td>
							<input type="checkbox" id="checkbox_monthly" name="monthly" checked="checked" value="True" onchange="changeDateSelector()">
						</td>
					</tr>
					<tr class="month_option monthly_options" style="display: none;">
						<td>
							<label>Year</label>
						</td>
						<td>
							<select id="selectorYear" name="selectorYear" class="selector"></select>
						</td>
					</tr>
					<tr class="month_option monthly_options" style="display: none;">
						<td>
							<label>Month</label>
						</td>
						<td>
							<select id="selectorMonth" name="selectorMonth" class="selector"></select>
						</td>
					</tr>
					<tr>
						<td>
							<button class="button fullWidth" onclick="addEntry();" id="addentry">Add Entry</button>
						</td>
						<td>
							<button class="button fullWidth" onclick="hideEntryDialog();">Close</button>
						</td>
					</tr>
				</table>
			</form>
		</div>
		
		<div id="edit_entry_div" style="display=none; position=absolute; z-index:5">
			<form onsubmit="return false;" id="edit_entry_form">
				<table class="fieldset" bgcolor="white">
					<tr>
						<td colspan="2">
							<label class="Heading blue" id="dialog_status">Edit Entry</label>
						</td>
					</tr>
					<tr>
						<td width="50%">
							<label for="edit_input_name" disabled="disabled">Entry Name</label>								
						</td>
						<td width="50%">
							<input style="width: 100%;" type="text" class="in required" id="edit_input_name" name="edit_input_name">
						</td>
					</tr>
					<tr>
						<td>
							<label for="edit_input_amount">Entry Amount</label>
						</td>
						<td>
							<input style="width: 100%;" type="text" class="in required" id="edit_input_amount" name="edit_input_amount">
						</td>
					</tr>
					<tr>
						<td>
							<label for="edit_entry_type">Type</label>
						</td>
						<td>
							<input type="radio" id="edit_entry_income" name="edit_entry_type" title="Income"> Income<br>
							<input type="radio" id="edit_entry_expense" name="edit_entry_type" title="Expense" checked="checked"> Expense
						</td>
					</tr>
					<tr>
						<td>
							Action
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<select style="width: 100%;" id="edit_entry_select"></select>
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<button class="button fullWidth" onclick="editEntry();">Apply</button>
						</td>
					</tr>
				</table>
			</form>
		</div>
		
		<div style="display: block;">
			<div id="sidebar">
				<button onclick="saveData();" class="bluebutton">Save</button><br/>
				<button class="button" onclick="showEntryDialogUnderEntryHeader(this)">+ ONE TIME ENTRY</button><br/>
				<button class="button" onclick="showEntryDialogUnderMonthly(this)">+ MONTHLY ENTRY</button><br/>
				<div style="background:#efefef; padding:4px 0 2px 0;width:100%;"><button class="button" onclick="toggleSort()">Filter</button></div>
				<div class="sort">
					<table width="100%" bgcolor="#efefef">
					<tr>
						<td><label>From</label></td>
						<td><select class="dirtyfilter" id="from_month"></select></td>
						<td><select class="dirtyfilter" id="from_year"></select></td>
						
					</tr>
					<tr>
						<td><label>To</label></td>
						<td><select class="dirtyfilter" id="to_month"></select></td>
						<td><select class="dirtyfilter" id="to_year"></select></td>
						
					</tr>
					<tr>
						<td>
							<label>Columns</label>
						</td>
						<td>
							<select id="num_cols" class="dirtyfilter fullWidth"></select>
						</td>
					</tr>
					<tr>
						<td></td>
						<td colspan="2">
							<button class="button fullWidth" onclick="refreshEntries()">Refresh</button>
						</td>
					</tr>
				</table>
				</div>
				<h2 style="margin:5px 0;">Monthly Entries</h2>
				<div id="monthly_entries">{{ data }}</div>
				
			</div>
			<div class="content">				
				<div id="entries"></div>
			</div>
		</div>
		
		<!-- Underscore Templates -->
	
		<script type="text/template" class="template">
			<table cellspacing = "0" style="font-size:14px;"cellpadding="2">
				<tr>
					<th width="33%">
						Name
					</th>
					<th width="33%">
						Amount
					</th>
				</tr>
				<% _.each(data, function(entry, key, list) { %>
				<tr class="entries">
					<td>
						<%- entry.get('name') %>
					</td>
					<td class="<%-entry.get('amount') < 0?'expense':'income'%>">
						<%-formatDollars(entry.get('amount'), '', true) %>
					</td>
				</tr>
				<% }); %>
			</table>
		</script>
		
		<script type="text/template" class="entries">
			<table width="100%" height="100%" cellspacing="16" cellpadding="0" bgcolor="#efefef"style="padding-top: 10px;" class="tableentries" >
				<% _.each(data.rowData, function(row, key, list) { %>
					
				<tr>
					<% _.each(row, function(month, key, list) { %>
						
					<td style='width: <%=data.entryWidth%>%;' class='monthModule tables <%=month.year%> <%=month.month%>'></td>
					
					<% }); %>
				</tr>
				
				<% }); %>
			</table>
		</script>
		
		<script type="text/template" id="templateMonthModule">
			<table style="width: 100%; height: 100%;" cellspacing="0" cellpadding="0" >
				<tr class="entries_first blue">
					<!-- YEAR MONTH -->
					<td colspan="2">
						<div class="year"><%- data.shortMonth + ' \'' + data.shortYear  %></div>
					</td>
					<td></td>
					<!-- ADD BUTTON -->
					<td align="right">
						<button style="float:right" class="button" id='addButton'>ADD</button>
					</td>
				</tr>
				
				<!-- STARTING BALANCE ROW -->
				<tr class="">
					<td style="width: 25%">
						<label class="preMonthMeta">Starting Balance: </label>
					</td>
					<td style="width: 25%">
						<form id="startBalanceForm" style="margin: 0px;">
							<% var sb = data.start_balance; %>
							<label id="startBalanceLabel" class="start_balance_label"><%=formatDollars(sb, '--')%></label>
							<input id="startBalanceInput" class="start_balance_input" type="text" />
						</form>
					</td>
					<td style="width: 25%">
						
					</td>
					<td style="width: 25%"></td>
				</tr>
				
				<!-- NAME EXPENSE INCOME -->
				<% if (data.entries.length > 0) { %>
				<tr>
					<th width="25%">
						Name
					</th>
					<th width="25%">
						Expense
					</th>
					<th width="25%">
						Income
					</th>
				</tr>
				
					<% _.each(data.entries, function(entry, key, list) { %>
					<% var amount = getModifiedAmount(entry, data.year, data.month); %>
					<% if(typeof amount == "undefined") return; %>
				<!-- ACTUAL ENTRIES -->
				<tr name="<%=key%>" class="entry_data editable_entry">
					<td class="<%-amount < 0?'expense':'income'%>">
						<%- entry.get('name') %>
					</td>
					<td>
						<span class="expense"><%-amount < 0? formatDollars(Math.abs(amount), ''): ''%></span>
					</td>
					<td>
						<span class="income"><%-amount > 0? formatDollars(amount, ''): ''%></span>
					</td>
					<td style="float: right;">
						<button class="show_on_hover smallButton" id="editButton">Edit</button>
						<button class="show_on_hover smallButton" id="deleteButton">Delete</button>
					</td>
				</tr>
					<% }); %>
				<% } %>
				
				<!-- SPACER ROW TO KEEP END OF MONTH LINED UP HORIZONTALLY -->
				<tr style="height: 100%;"></tr>
				
				<!-- TOTAL -->
				<tr class="" valign="bottom">
					<td>
						<label class="preMonthMeta">Total</label>
					</td>
					<td>
						<%=formatDollars(data.total_expenses, '')%>
					</td>
					<td>
						<%=formatDollars(data.total_income, '') %>
					</td>
				</tr>
				
				<!-- ENDING BALANCE -->
				<tr>
					<td>
						<label class="preMonthMeta">Ending Balance:</label>
					</td>
					<td>
						<label><%=formatDollars(data.end_balance, '')%></label>
					</td>
				</tr>
				
				<!-- DISCREPANCY -->
				<tr>
					<td>
						<label class="preMonthMeta">Discrepancy: </label>
					</td>
					<td>
						<label><%=formatDollars(data.discrepancy, '$0')%></label>
					</td>
				</tr>
			</table>
		</script>
		{% endif %}
	</body>
</html>
